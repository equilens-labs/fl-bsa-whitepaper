# LaTeX Whitepaper Structure

This document describes the LaTeX publication project structure for the FL-BSA regulatory whitepaper.

---

## Overview

The whitepaper is a publication-ready LaTeX project designed for:
- **Regulatory review**: Precise, evidence-forward tone with equations and references
- **arXiv submission**: No shell-escape, no custom fonts, uses natbib + BibTeX
- **Partial results**: Compiles with "TBD" placeholders when metrics are missing
- **Auto-population**: Tables fill automatically from `intake/metrics_uncertainty.json` (v4 SoT)

---

## Project Structure

```
main.tex                  % top-level file
sections/                 % logical sections (exec summary, estimands, methods, results, ...)
includes/
  macros.tex              % global macros, thresholds (defaults)
  metrics_macros.tex      % auto-generated (safe placeholder if absent)
  table_air_summary.tex   % auto-generated from metrics
  table_srg_summary.tex   % auto-generated from metrics (approval-rate gap)
  table_ece_summary.tex   % auto-generated from metrics
scripts/
  gen_tex_macros_from_metrics.py  % reads intake/metrics_uncertainty.json (preferred) + config/sap.yaml -> includes/*.tex
  arxiv_pack.sh                   % packages arXiv source
bib/references.bib        % natbib (arXiv-friendly)
.github/workflows/latex.yml % CI: build PDF + arXiv source
Makefile                  % make pdf | make arxiv | make clean
```

---

## Auto-Generated Macros

The `gen_tex_macros_from_metrics.py` script reads metrics and generates LaTeX macros:

```bash
python3 scripts/gen_tex_macros_from_metrics.py \
  --metrics intake/metrics_long.csv \
  --sap config/sap.yaml \
  --outdir includes
```

This writes:
- `includes/metrics_macros.tex` — macros like `\MinAIR`, `\NumAIRViolations`, thresholds, etc.
- `includes/table_air_summary.tex`, `table_srg_summary.tex`, `table_ece_summary.tex` — ready-to-`\input{}` tables using booktabs.

---

## Document Sections

| Section | Content |
|---------|---------|
| Executive Summary | Purpose, thresholds, and live metric snapshot (AIR + approval-rate gap) |
| Problem & Estimands | Formal definitions (AIR, approval-rate gap, calibration note) with equations |
| Methods | Estimators and uncertainty (Wilson + delta-log AIR CI; small-n safeguards) |
| Model & Algorithm | Dual-branch generator description and post-hoc fairness evaluation |
| Evaluation Design | Splits, calibration, robustness |
| Results | Tables auto-`\input{}` from `includes/table_*.tex` |
| Compliance | Regulatory anchors (ECOA, EU AI Act, FCA) |
| Security/Privacy | Privacy guarantees and evidence |
| Reproducibility | Provenance and audit trail |
| Limitations | Known constraints and monitoring strategy |
| Appendix A | SAP summary |
| Appendix B | Metric definitions |

---

## Build Commands

### Local Build
```bash
# Generate macros (tolerant if intake/ missing):
make macros

# Build PDF:
make pdf
# Outputs: dist/whitepaper.pdf

# ArXiv source package (includes .bbl):
make arxiv
# Outputs: dist/whitepaper_arxiv_source.zip
```

### CI/CD (GitHub Actions)
The `.github/workflows/latex.yml` workflow:
1. Generates macros from `intake/metrics_uncertainty.json` (preferred) + `config/sap.yaml`
2. Compiles LaTeX with latexmk → PDF artifact
3. Packages arXiv source → `dist/whitepaper_arxiv_source.zip`
4. On release: attaches PDF and arXiv bundle to GitHub release

---

## arXiv Compatibility

- Uses **natbib + BibTeX** (not biblatex) for bibliography
- No **shell-escape** or uncommon packages
- `make arxiv` includes `.bbl` file for smoother arXiv ingestion
- Defaults to Computer Modern fonts (arXiv-safe)

---

## Partial Results Handling

If the v4 SoT (`intake/metrics_uncertainty.json`) is missing or incomplete:
- Executive Summary shows **TBD** where numbers would appear
- Tables compile with placeholder rows
- Once metrics are added, regenerate macros and recompile

---

## Evidence Source

Metrics are generated by running `make gate-wp` in the `fl-bsa` repository. The bundle is then copied to `intake/` in this repo before compiling the whitepaper.
